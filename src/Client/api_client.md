---
layout: page
title: "API Client-ի ստեղծում" 
sublinks:
- { title: "Ինչ է Api Client-ը", ref: ինչ-է-api-client-ը }
- { title: "Մանիֆեստ, manifest.json", ref: մանիֆեստ }
- { title: "Մանիֆեստի օրինակ, manifest.json", ref: մանիֆեստի-օրինակ }
nav_exclude: true
---

# API Client-ի ստեղծում

## Բովանդակություն

- [Ինչ է Api Client-ը](#ինչ-է-api-client-ը)
- [Api Client-ի ստեղծում](#api-client-ի-ստեղծում)
- [Մանիֆեստ](#մանիֆեստ)
  - [Մանիֆեստի դաշտերի նկարագրություն](#մանիֆեստի-դաշտերի-նկարագրություն)
  - [Մանիֆեստի օրինակ](#մանիֆեստի-օրինակ)
  - [Մանիֆեստի ներմուծում](#մանիֆեստի-ներմուծում)
  - [Մանիֆեստի արտահանում](#մանիֆեստի-արտահանում)

## Ինչ է Api Client-ը

8X սերվիսին որևէ ծրագրից միանալու համար անհրաժեշտ է նախապես սահմանել մուտք գործելու տվյալները բանալիով (գաղտնիքով)։
Այդ տվյալները կոչվում են Api Client։

Առկա է սահմանված մուտք գործելու երեք եղանակ։
1. Ինտեգրացիոն ծրագրի և գաղտնի բանալու սահմանում ՀԾ-Բանկում։
2. Օգտագործողի սահմանում ՀԾ-Բանկում (SQL նույնականացում), և գաղտնագրման սերտիֆիկատի սահմանում։
  Սերտիֆիկատը օգտագործվում է կապուղին գաղտնագրման համար։
3. Օգտագործողի սահմանում ՀԾ-Բանկում և Active Directory-ում, և գաղտնագրման սերտիֆիկատի սահմանում։
  Սերտիֆիկատը օգտագործվում է կապուղին գաղտնագրման համար։  
  Այս տարբերակը գործում է դեռևս միայն 4X UI ծրագրերի միջից։

## Api Client-ի ստեղծում

Այն անհրաժեշտ է ստեղծել 4X կամ 8X համակարգում **Ադմինիստրատորի ԱՇՏ**-ի **API Client-ներ** դիտելու ձևի **Ավելացնել** կոնտեքստային ֆունկցիայով, նշելով`
* Կլիենտի անվանումը (առավելագույնը 50 նիշ)։
* Json ֆորմատի [Մանիֆեստ](#մանիֆեստ) ֆայլ, որը սահմանում է կլիենտ ծրագրի իրավասությունները և սահմանափակումները։
* Կլիենտի վավերականացման եղանակը՝ սերտիֆիկատով կամ բանալիով։  
  **Սերտիֆիկատով** նշիչը ընտրելու դեպքում անհրաժեշտ է նշել **Սերտիֆիկատի ճանապարհը**, հակառակ դեպքում **Բանալի** դաշտում գեներացնել նոր բանալի։
* Կլիենտը ակտիվ է, թե ոչ։
* Կլիենտը հարցումները կատարելուց օգտագործում է յունիկոդ կոդավորում, թե Ansi կոդավորում:

![api_client_add](Images/api_client_add.png)

## Մանիֆեստ 

**Մանիֆեստ**-ը json ընդլայնմամբ ֆայլ է, որը պարունակում է կլիենտ ծրագրի իրավասություններն ու սահմանափակումները՝ 
* որ օգտագործողները կարող են մուտք գործել համակարգ, 
* ինչ տվյալների աղբյուրների, փաստաթղթերի և DPR-ների կարող են դիմել,
* ինչ API կանչեր կարող են կատարվել։

**Մանիֆեստ** ֆայլի կառուցվածքը նկարագրված է JSON Schema-ով, որը հասանելի է https://armsoftupdates.blob.core.windows.net/schemas/ClientManifestJsonSchema.json հասցեով։

JSON Schema-ն օգտագործելու համար անհրաժեշտ է՝
* բացել Visual Studio-ի **Tools** մենյուի **Options** պատուհանը,
* պատուհանի **Json -> Schema** բաժնում ավելացնել սխեմաների հասցեն` https://armsoftupdates.blob.core.windows.net/schemas/Catalog.json։

![api_client_options_json_schema_add](Images/api_client_options_json_schema_add.png)

Այս քայլերի կատարումից հետո Visual Studio-ի միջավայրում **.json** ընդլայնմամբ ֆայլերի համար Schema անհրաժեշտ է ընտրել https://armsoftupdates.blob.core.windows.net/schemas/ClientManifestJsonSchema.json հասցեով JSON Schema-ն։

![api_client_json_schema_apply](Images/api_client_json_schema_apply.png)

## Մանիֆեստի դաշտերի նկարագրություն

| Անուն |  Նկարագրություն | Շարահյուսություն |
|--|--|--|
| `dataSources` | Սահմանում է այն տվյալների աղբյուրների ցուցակը, որոնք տվյալ API Client-ը իրավասություն ունի կատարել։ | `"dataSources": [ "DS1", "DS2" ]` |
| `allDataSources` | Համակարգում առկա բոլոր տվյալների աղբյուրների կատարման հասանելիության հայտանիշ: **true** արժեքի դեպքում անտեսվում է `dataSources` ցուցակը։ | `"allDataSources": true` |
| `documents` | Սահմանում է այն փաստաթղթերի ցուցակը, որոնք կարող են ստեղծվել, գրանցվել, բեռնվել կամ հեռացվել  տվյալ API Client-ի կողմից: | `"documents": [ "Doc1", "Doc2" ]` |
| `allDocuments` | Համակարգում առկա բոլոր փաստաթղթերի գործարկման հասանելիության հայտանիշ: **true** արժեքի դեպքում անտեսվում է `documents` ցուցակը։ | `"allDocuments": true` |
| `dataProcessingRequests` | Սահմանում է այն տվյալների մշակման հարցումների (DPR-ների) ցուցակը, որոնք տվյալ API Client-ը իրավասություն ունի գործարկել։ | `"dataProcessingRequests": [ { "name": "Dpr1", "type": 21 }, { "name": "Dpr2", "type": 22 } ]` |
| `allDataProcessingRequests` | Համակարգում առկա բոլոր տվյալների մշակման հարցումների (DPR-ների) գործարկման հասանելիության հայտանիշ: **true** արժեքի դեպքում անտեսվում է `dataProcessingRequests` ցուցակը։ | `"allDataProcessingRequests": true` |
| `controllers` | Սահմանում է տվյալ API Client-ի համար հասանելի controller-ները և դրանց action-ները։ Կարելի է յուրաքանչյուր controller-ի համար նշել կոնկրետ action-ների ցուցակ կամ սահմանել allActions: true, որի դեպքում տվյալ controller-ի բոլոր action-ները կդառնան հասանելի։ | `"controllers": { "Cntrl1": { "allActions": true }, "Cntrl2": { "actions": [ "action1" ] } }` |
| `allControllers` | Համակարգում առկա բոլոր controller-ների գործարկման հասանելիության հայտանիշ: **true** արժեքի դեպքում անտեսվում է `controllers`-ը։ | `"allControllers": true` |
| `users` | Սահմանում է այն օգտագործողների ներքին անունների ցուցակը, որոնք իրավասություն ունեն մուտք գործել համակարգ տվյալ API Client-ով։ | `"users": [ "user1", "user2" ]` |
| `allUsers` | Համակարգում առկա բոլոր օգտագործողների մուտքի հասանելիության հայտանիշ: **true** արժեքի դեպքում անտեսվում է `users` ցուցակը։ | `"allUsers": true` |
| `IPs`    | Սահմանում է այն IP հասցեների ցուցակը, որոնցից թույլատրվում է կատարել API հարցումներ (controller-ների action-ների գործարկում) տվյալ API Client-ով։ | `"IPs": [ "192.168.1.10", "10.0.0.5" ]` |
| `allIPs` | API հարցումների կատարման հասանելիության հայտանիշ՝ բոլոր IP հասցեներից։ **true** արժեքի դեպքում անտեսվում է `IPs` ցուցակը։ | `"allIPs": true` |
| `maxDPRCount` | Սահմանում է միաժամանակ կատարվող տվյալների մշակման հարցումների (DPR) առավելագույն քանակը տվյալ API Client-ի համար։ Լռությամբ արժեքը 15 է։ Այս հատկությունը կիրառելի է միայն ոչ համակարգային API Client-ների համար (համակարգային են համարվում այն API Client-ները, որոնց ID < 50)։   | `"maxDPRCount": 10` |
| `maxSessionCount` | Սահմանում է միաժամանակ բացված սեսսիաների առավելագույն քանակը տվյալ API Client-ի համար։ Լռությամբ արժեքը 5 է։ Այս հատկությունը կիրառելի է միայն ոչ համակարգային API Client-ների համար (համակարգային են համարվում այն API Client-ները, որոնց ID < 50)։   |  `"maxSessionCount": 7` |
| IsUsernameRequired | /api/Login/WithSecret Api-ով համակարգ մուտք գործելիս username պարամետրի պարտադիր լրացման հայտանիշ։ | `"IsUsernameRequired": true` |


## Մանիֆեստի օրինակ

```json
{
  "dataSources": [
    "DS1",
    "DS2"
  ],
  "documents": [
    "Doc1",
    "Doc2"
  ],
  "allDataProcessingRequests": true,
  "controllers": {
    "Cntrl1": {
      "allActions": true
    },
    "Cntrl2": {
      "actions": [
        "action1"
      ]
    }
  },
  "users": [
    "user1",
    "user2"
  ]
}
```
## Մանիֆեստի ներմուծում

Գոյություն ունեցող կլիենտ ծրագրի **Մանիֆեստ**-ը փոփոխելու համար անհրաժեշտ է կանչել **Ադմինիստրատորի ԱՇՏ**-ի **API Client-ներ** դիտելու ձևի **Մանիֆեստի ներմուծում** կոնտեքստային ֆունկցիան և բացված պատուհանում նշել ներմուծվող մանիֆեստի ճանապարհը։

## Մանիֆեստի արտահանում

Գոյություն ունեցող կլիենտ ծրագրի **Մանիֆեստ**-ը ստանալու համար անհրաժեշտ է կանչել **Ադմինիստրատորի ԱՇՏ**-ի **API Client-ներ** դիտելու ձևի **Մանիֆեստի արտահանում** կոնտեքստային ֆունկցիան և բացված պատուհանում նշել ֆայլի արտահանման ճանապարհը։
