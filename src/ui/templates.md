---
title: Տպելու ձևանմուշների ներքին կառուցվածք
---

## Բովանդակություն

- [Ատոմիկներ](#ատոմիկներ)
- [Նկարներ](#նկարներ)
- [Աղյուսակներ](#աղյուսակներ)
- [Տպելու ձևանմուշների վալիդացիա](#տպելու-ձևանմուշների-վալիդացիա)
- [Տպելու ձևանմուշի հաշվարկման և լրացման օրինակ](#տպելու-ձևանմուշի-հաշվարկման-և-լրացման-օրինակ)

## Ատոմիկներ

Տպելու ձևանմուշներում ատոմիկները նշվում են հատուկ սիմվոլներով՝ **#**, **^**, **$**, որոնց անմիջապես հաջորդում է ատոմիկի կոդը (առանց բացատների), օրինակ՝ **#TOTAL**, **^201**, **$1008**։

Ձևանմուշի ֆայլի տեսակից կախված՝ կիրառելի են հատուկ սիմվոլների կիրառման հետևյալ սահմանափակումները․
* Word (*.doc, *.docx) – **#**, **^**, **$**
* Excel (*.xlsx, *.xlsm) – **#**, **^**
* Text (*.txt) – միայն **#**

Ձևանմուշի լրացման ընթացքում բոլոր ատոմիկները փոխարինվում են համապատասխան հաշվարկված արժեքներով։

**Հատուկ սիմվոլների կիրառման առանձնահատկություններ և սահմանափակումներ՝**
* Word (*.doc, *.docx) տեսակի ձևանմուշների header, footer հատվածներում **^** և **$** սիմվոլների կիրառումը չի սատարվում․ կիրառման դեպքում համապատասխան ատոմիկների կոդերը չեն փոխարինվում արժեքներով և մնում են անփոփոխ։
* Word (*.doc, *.docx) տեսակի ձևանմուշների մարմնում (Body) ատոմիկների համար **^** և **$** սիմվոլների կիրառման դեպքում, եթե ձևանմուշի հաշվարկման արդյունքում ատոմիկի արժեքը դատարկ է (string.Empty, null, բացատներ, ․․․), ապա այն պարունակող պարագրաֆը ամբողջությամբ հեռացվում է։
* Excel (*.xlsx, *.xlsm) տեսակի ձևանմուշների cell-ում տարբեր ֆորմատավորմամբ ատոմիկների (bold, italic, ...) համար **^** սիմվոլի կիրառման դեպքում, եթե ձևանմուշի հաշվարկման արդյունքում ատոմիկի արժեքը դատարկ է (string.Empty), ապա ատոմիկի կոդը չի փոխարինվում արժեքով և մնում է անփոփոխ։ իսկ cell-ում նույն ֆորմատավորմամբ ատոմիկների կամ ֆորմատավորման բացակայության և ատոմիկի դատարկ արժեքի դեպքում (string.Empty), ապա ատոմիկի կոդը փոխարինվում է մեկ բացատով` " ":

**Հատուկ սիմվոլների կիրառման առանձնահատկություններ և սահմանափակումներ՝**
* Word (*.doc, *.docx) տեսակի ձևանմուշների header, footer հատվածներում **^** և **$** սիմվոլների կիրառումը չի սատարվում․ կիրառման դեպքում համապատասխան ատոմիկների կոդերը չեն փոխարինվում արժեքներով։
* Word (*.doc, *.docx) տեսակի ձևանմուշների մարմնում (Body), եթե ատոմիկի համար կիառված են **^** և **$** սիմվոլները և ատոմիկի արժեքը դատարկ է (string.Empty, null, բացատներ), ապա այն պարունակող պարագրաֆը ամբողջությամբ հեռացվում է։
* Excel (*.xlsx, *.xlsm) տեսակի ձևանմուշների cell-ում, եթե ատոմիները ունեն տարբեր ֆորմատավորումներ (bold, italic, ...) և կիրառված է **^** սիմվոլը, ապա դատարկ արժեք (string.Empty) ունեցող ատոմիկները չեն փոխարինվում արժեքներով։ Սակայն նույն ֆորմատավորմամբ ատոմիկների կամ ֆորմատավորման բացակայության դեպքում դատարկ արժեքը փոխարինվում է մեկ բացատով (" "):

## Նկարներ

Տպելու ձևանմուշում նկարները նշվում են **#** հատուկ սիմվոլով, որին հաջորդում է նկարի անունը (առանց բացատների)։ Օրինակ՝ **#ClientImage**։

Եթե Word (\*.doc, \*.docx) տեսակի ձևանմուշում նշված անունով նկարի ֆայլը բացակայում է, ապա համակարգը հեռացնում է համապատասխան placeholder-ը (օրինակ՝ #ClientImage)։ Excel (\*.xlsx, \*.xlsm) տեսակի ձևանմուշներում նշված դեպքում առաջանում է սխալ։

## Աղյուսակներ

Տպելու ձևանմուշներում աղյուսակային տվյալները նշվում են հետևյալ ձևով՝ %table_name.column_name: Աղյուսակային արժեքի գրառումը սկսվում է % սիմվոլով, որին հաջորդում է աղյուսակի անունը և սյան անունը՝ կետով բաժանված։ Օրինակ՝ **%T1.C1**, **%ACC.CODE**։

## Տպելու ձևանմուշների վալիդացիա

Վալիդացիան հնարավորություն է տալիս ստուգել ձևանմուշի լրացման արդյունքում չփոխարինված ատոմիկների, աղյուսակային արժեքների առկայությունը։

Այն կարելի է միացնել`
* «Դրույթներ» (Ctrl+o) -> «Ծրագրավորողի գործիքներ» -> «Տպվող տեսքերի ստուգում» նշիչի միջոցով (այն ազդում է միայն UI-ց տպելու ձևանմուշի կանչի դեպքում)։ Նշիչի լռությամբ արժեքը false է։
* TemplateSubstitutionService, TemplateSubstitutionController-ի մեթոդների bool check պարամետրի արժեքավորման միջոցով։

![template_validate](images/template_validate.png)

![check_parameter](images/check_parameter.png)

Վալիդացիայի միացված լինելու դեպքում՝
* Text (.txt) և Doc (.doc, .docx) տեսակի տպելու ձևանմուշներում, եթե լրացման արդյունքում մնում են չփոխարինված ատոմիկներ (Text դեպքում՝ ցանկացած տեսակի, օրինակ՝ #21, #CurrentDate, Doc դեպքում՝ ^ և $ տեսակների, օրինակ՝ ^105, $Code), ապա առաջանում է սխալ։
* Doc (.doc, .docx) և Excel (.xlsx, .xlsm) տեսակի տպելու ձևանմուշներում, եթե լրացման արդյունքում մնում են չփոխարինված ատոմիկներ (Doc դեպքում՝ # տեսակի, օրինակ՝#Acc, Excel դեպքում՝ ցանկացած տեսակի, օրինակ` #Acc, ^16), ապա ստուգվում է տվյալ ատոմիկի առկայությունը նկարների բազմությունում (**TemplateSubstitution.imagesubstitutions**)։ Նշված բազմությունում բացակայության դեպքում առաջանում է սխալ։
* Doc (.doc, .docx) տեսակի տպելու ձևանմուշներում, եթե լրացման արդյունքում մնում են չփոխարինված աղյուսակային արժեքներ (օրինակ՝ %T1.C1), ապա առաջանում է սխալ։

## Տպելու ձևանմուշի հաշվարկման և լրացման օրինակ

```c#
var printTemplateSubstitution = new PrintTemplateSubstitution();
printTemplateSubstitution.AtomicSubstitutions.Add("C01", "Թեստային կազմակերպություն");
printTemplateSubstitution.AtomicSubstitutions.Add("1", 1);

PrintTemplateSubstitutionGrid gridSubstitutions1 = printTemplateSubstitution.GridSubstitutions.Add("Prices");

gridSubstitutions1.AddColumn("Code", "Product's code");
gridSubstitutions1.AddColumn("Price", "Product's price");

for (int i = 0; i < 2; i++)
{
    gridSubstitutions1.AddRow();
    int id = i + 1;
    int price = id * 100;

    gridSubstitutions1.SetValue(i, "Code", id);
    gridSubstitutions1.SetValue(i, "Price", price);
}
```

![template_input_example](images/template_input_example.png)

![template_output_example](images/template_output_example.png)
