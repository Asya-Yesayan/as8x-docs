<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">

  <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
  <link id="darktheme" rel="" href="{{ "/assets/dark.css" | relative_url }}">
  <script src="{{ "/assets/manageThemes.js" | relative_url }}"></script>

  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  <link rel="alternate" type="application/rss+xml" title="{{ site.title | escape }}" href="{{ "/feed.xml" | relative_url }}">

  {% if page.tipue_search_active or layout.tipue_search_active %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="{{ "/assets/tipuesearch/tipuesearch_content.js" | relative_url }}"></script>
    <link rel="stylesheet" href="{{ "/assets/tipuesearch/css/tipuesearch.css" | relative_url }}">
    <script src="{{ "/assets/tipuesearch/tipuesearch_set.js" | relative_url }}"></script>
    <script src="{{ "/assets/tipuesearch/tipuesearch.min.js" | relative_url }}"></script>
  {% endif %}

  {% if page.tipue_search_index or layout.tipue_search_index %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="{{ "/assets/tipuesearch/tipuesearch_content.js" | relative_url }}"></script>
    <link rel="stylesheet" href="{{ "/assets/tipuesearch/css/tipuesearch.css" | relative_url }}">
    <script src="{{ "/assets/getindex.js" | relative_url }}"></script>
    <link rel="stylesheet" href="{{ "/assets/apiIndex.css" | relative_url }}">
  {% endif %}

  {% include copy-button.html %}

  <!-- Version selector -->
  <style>
    #version-selector {
      margin-top: 1em;
      max-width: 300px;
    }
  </style>

  <select id="version-selector" onchange="selectVersion(this.value)">
    {% for product, versions_list in site.versions %}
      {% if versions_list %}
        <optgroup label="{{ product }}">
          {% for version in versions_list %}
            <option value="{{ product }}|{{ version }}">{{ version }}</option>
          {% endfor %}
        </optgroup>
      {% endif %}
    {% endfor %}
  </select>

  <script>
    function versionCompare(v1, v2) {
      return v1.localeCompare(v2, undefined, { numeric: true });
    }

    function parseVersion(fullValue) {
      if (!fullValue.includes('|')) return { product: '', version: fullValue };
      const [product, version] = fullValue.split('|');
      return { product, version };
    }

    function selectVersion(fullValue) {
      localStorage.setItem('selectedVersion', fullValue);
      const { version } = parseVersion(fullValue);
      showVersionBlocks(version);
    }

    function showVersionBlocks(version) {
      document.querySelectorAll('.version-block').forEach(el => {
        const exact = el.getAttribute('data-version');
        const min = el.getAttribute('data-version-min');
        const max = el.getAttribute('data-version-max');

        let show = false;

        if (exact) {
          const versions = exact.split(',').map(v => v.trim());
          show = versions.includes(version);
        } else {
          const aboveMin = min ? versionCompare(version, min) >= 0 : true;
          const belowMax = max ? versionCompare(version, max) <= 0 : true;
          show = aboveMin && belowMax;
        }

        el.style.display = show ? "" : "none";
      });
    }

    document.addEventListener('DOMContentLoaded', function () {
      const dropdown = document.getElementById('version-selector');
      let selected = localStorage.getItem('selectedVersion');

      if (!selected || !dropdown.querySelector(`option[value="${selected}"]`)) {
        selected = dropdown.options[0]?.value;
      }

      if (dropdown && selected) {
        dropdown.value = selected;
        selectVersion(selected);
      }
    });
  </script>
</head>
